{% extends "vps/view-hdr.html" %}
{% set subtitle='Dashboard' %}
{% block title %}{{ service.name }} - Servers{% endblock %}

{% block component %}

<div class="row-fluid pushdown">
	<div class="span6">
		<h4>Memory:</h4>
		<span class="specification">{{ service.memory }} mb</span>
	</div>

	<div class="span6">
		<h4>Swap:</h4>
		<span class="specification">{{ service.swap }} mb</span>
	</div>
</div>

<div class="row-fluid pushdown">
	<div class="span6">
		<h4>Disk:</h4>
		<span class="specification">{{ service.disk }} gb</span>
	</div>

	<div class="span6">
		<h4>Expiry:</h4>
		{% if service.expiry %}
		<span class="specification">{{ service.expiry | strftime('%m/%d/%Y') }} (${{ service.price | strf("{0:.2f}") }} per month)</span>
		{% else %}
		<span class="specification">Inactive</span>
		{% endif %}
	</div>
</div>

<div class="row-fluid pushdown">
	<div class="span6">
		<h4>IPv4:</h4>
		<span class="specification">{{ service.ips[0].ip if service.ips[0] }}</span>
	</div>

	<div class="span6">
		<h4>IPv6:</h4>
		<span class="specification">{{ service.ips[1].ip if service.ips[1] }}</span>
	</div>
</div>

<div class="row-fluid pushdown">
	<div class="span6">
		<h4>Host:</h4>
		<span class="specification">{{ service.node.name }}</span>
	</div>

	<div class="span6">
		<h4>Location:</h4>
		<span class="specification">{{ service.node.region.name }}</span>
	</div>
</div>

<div class="row-fluid">
	<div class="span6">
		<h4>CPU (8 cores):</h4>
		<div id="cpu-graph" class="span12 minigraph"></div>
	</div>

	<div class="span6">
		<h4>Network (20mbps guaranteed):</h4>
		<div id="net-graph" class="span12 minigraph"></div>
	</div>
</div>

<div class="row-fluid">

<div class="span6">
<h4>Kernel Profiles:</h4>

{% for prof in profiles %}
<div class="row-fluid">
	<div class="span6">
		{{ prof.name }}{% if prof.id == service.profile.id %} [selected default]{% endif %}
	</div>
	<div class="span6">
		<form class="pull-right" method="POST" action="{{ url_for('.setprofile', vps=service.id) }}">
			<input type="hidden" name="profid" value="{{ prof.id }}">
			<button type="submit" class="btn">Set Default</button>
		</form>

		<form class="pull-right" method="POST" action="{{ url_for('.create', vps=service.id) }}">
			<input type="hidden" name="profid" value="{{ prof.id }}">
			<button type="submit" class="btn btn-primary">Boot</button>&nbsp;
		</form>
	</div>
</div>
{% endfor %}
</div>

<div class="span6">

<h4>Settings:</h4>

<div class="row-fluid" style="margin-bottom: 20px">
	<div class="span6">
		Restart VPS if not physically running:
	</div>
	<div class="span6">
	<span class="pull-right">
	{% if service.watchdog != True %}
		<a href="{{ url_for('.start_monitoring', vps=service.id) }}" class="btn btn-success">Enable</a>
	{% else %}
		<a href="{{ url_for('.stop_monitoring', vps=service.id) }}" class="btn btn-danger">Disable</a>
	{% endif %}
	</span>
	</div>
</div>

<div class="row-fluid" style="margin-bottom: 20px">
	<div class="span6">
		Delete this VPS:
	</div>
	<div class="span6">
		<span class="pull-right">
		<a href="#admDelete" role="button" data-toggle="modal" class="btn btn-danger">Delete</a>
		</span>
	</div>
</div>

</div>

</div>


<script type="text/javascript">
$(function() {
    var __tmf = "%H:%M";
    var __start = 3600;
    var __step = 60;
    var __baseuri = "";
    var __callback = null;

    function cpu_data_received(newdata, tmf) {
        var placeholder = $("#cpu-graph");
        var options = {
            lines: { show: true, fill: 0.7, lineWidth: 0 },
    	    points: { show: false },
   	    grid: { show: true, borderColor: '#dddddd', borderWidth: 1 },
	    xaxis: { mode: "time", timeformat: tmf, timezone: "browser" },
            yaxis: { min: 0, label: "CPU usage (%)", tickFormatter: function(num, obj) { return num.toFixed(2) + "%"; } }
        }

        $.plot(placeholder, [newdata], options);
    }

    function net_data_received(newdata, tmf) {
        var placeholder = $("#net-graph");
        var options = {
            series: { stack: true },
            legend: { show: true },
            lines: { show: true, fill: 0.7, stack: false, lineWidth: 0 },
    	    points: { show: false },
   	    grid: { show: true, borderColor: '#dddddd', borderWidth: 1 },
	    xaxis: { mode: "time", timeformat: tmf, timezone: "browser" },
            yaxis: { min: 0, label: "CPU usage (%)", tickFormatter: function(num, obj) {
                    if (num <= 1) { return num.toFixed(2); }
                    var suffix = ['', 'K', 'M', 'G'];
                    var i = parseInt(Math.floor(Math.log(num) / Math.log(1000)));
                    num /= Math.pow(1024, i);
                    return num.toFixed(2) + suffix[i];
                }
            }
        }

        $.plot(placeholder, newdata, options);
    }

    function get_uri(topic) {
        return '/vps/{{ service.id }}/' + topic + '/' + __start + '/' + __step;
    }

    $.ajax({
        url: get_uri('cpustats'),
        type: 'GET',
        dataType: 'json',
        success: function(d) { cpu_data_received(d, __tmf); }
    });

    $.ajax({
        url: get_uri('netstats'),
        type: 'GET',
        dataType: 'json',
        success: function(d) { net_data_received(d, __tmf); }
    });
});
</script>

{% endblock %}
